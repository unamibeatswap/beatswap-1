import { validatePreviewUrl } from "@sanity/preview-url-secret";
import { perspectiveCookieName } from "@sanity/preview-url-secret/constants";
import { draftMode, cookies } from "next/headers";
import { redirect } from "next/navigation";
function defineEnableDraftMode(options) {
  const { client } = options;
  return {
    GET: async (request) => {
      const {
        isValid,
        redirectTo = "/",
        studioPreviewPerspective
      } = await validatePreviewUrl(client, request.url);
      if (!isValid)
        return new Response("Invalid secret", { status: 401 });
      const draftModeStore = await draftMode();
      draftModeStore.isEnabled || draftModeStore.enable();
      const dev = process.env.NODE_ENV !== "production", cookieStore = await cookies(), cookie = cookieStore.get("__prerender_bypass");
      return cookieStore.set({
        name: "__prerender_bypass",
        value: cookie?.value,
        httpOnly: !0,
        path: "/",
        secure: !dev,
        sameSite: dev ? "lax" : "none"
      }), studioPreviewPerspective && cookieStore.set({
        name: perspectiveCookieName,
        value: studioPreviewPerspective,
        httpOnly: !0,
        path: "/",
        secure: !dev,
        sameSite: dev ? "lax" : "none"
      }), redirect(redirectTo);
    }
  };
}
export {
  defineEnableDraftMode
};
//# sourceMappingURL=draft-mode.js.map
